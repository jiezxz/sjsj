<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>车间看板</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">


    <style>
              ::-webkit-scrollbar { width: 0.1em; }
        /* 表格样式 */
        table {
            border-collapse: collapse;
            width: 100%;
            text-align: center;
        }

        /* 表头样式 */
        th {
           
            background-color: #ddd;
            border: 3px solid #ddd;
        }

        /* 表体样式 */
        td {
            width: 20%;
            padding: 0px;
            font-size: 35px;
            border: 3px solid #ddd;
        }
        tr{
            height: 10%;
        }

        /* 鼠标悬停表格样式 */
        tr:hover {
            background-color: #f5f5f5;
        }

        .title {
            font-weight: bold;
            background-color: steelblue;
            font-size: 40px;
            color: #fff;
        }
        .number{
            font-size: 60px;

        }
        .bold{
            font-weight: bold;
            font-size: 60px;
        }
        .yg{

            text-align: center; width: 60px;float: left; margin: 10px;
        }
        .yg img{ width:100% ; float: left;    width: 60px;
    height: 80px;}
        .name{
            width: 100%;
    font-size: 12px;
    float: left;
    text-align: center;
        }
        .title1 td{
           
        }
    </style>
</head>

<body ontouchstart="" class="page-bg">
    <table>
        <thead>
            <tr>
                <td colspan="5" class="title"  >
                <span id="year"></span><span id="t_year">年</span>
                <span id="month"></span><span id="t_month">月</span>
                <span id="day"></span><span id="t_day">日</span>
                                      <span id="t_scqk">生产情况</span> </td>
            </tr>
        </thead>
        <tbody>
            <tr style="    background-color: aliceblue;font-weight: bold;"  class="title1">
                <td id="t_cx">产线</td>
                <td  id="t_ddh">订单号</td>
                <td  id="t_gg">规格</td>
                <td  id="t_jrcqrs">今日出勤人数</td>
                <td  id="t_ywgk">异物管控</td>
            </tr>
            <tr>
                <td id="shengChanXian"></td>
                <td id="dingDanHao"> </td>
                <td id="guiGe"></td>
                <td id="jrcqrs" class="bold"></td>
                <td id="ywgk"  class="bold"></td>
            </tr>
            <tr style="    background-color: khaki;
        font-weight: bold;" class="title1">
                <td id="t_xm">项目</td>
                <td id="t_rmb">日目标</td>
                <td id="t_sj">实绩</td>
                <td id="t_dc">达成率</td>
                <td id="t_dbzt">对比昨天</td>
            </tr>
            <tr>
                <td><span  id="t_mj">母卷</span>(wm²)</td>
                <td id="mj_rmb" class="pingfang number"> </td>
                <td id="mj_sj" class=" bold"></td>
                <td id="mj_dcl" class="baifen bold"></td>
                <td id="mj_dbzt" class="bold"  style=" transform: scale(2, 1);"></td>
            </tr>

            <tr>
                <td><span id="t_yzl">运转率</span>(%)</td>
                <td id="yzl_rmb" class="baifen number"> </td>
                <td id="yzl_sj" class="baifen bold"></td>
                <td id="yzl_dcl" class="baifen bold"></td>
                <td id="yzl_dbzt" class="bold"  style=" transform: scale(2, 1);"></td>
            </tr>

            <tr>
                <td><span id="t_al">A率</span> (%)</td>
                <td id="al_rmb" class="baifen number"> </td>
                <td id="al_sj" class="baifen bold"></td>
                <td id="al_dcl" class="baifen bold"></td>
                <td id="al_dbzt" class="bold"  style=" transform: scale(2, 1);"></td>
            </tr>
            <tr>
                <td> <span id="t_sl">收率</span> (%)</td>
                <td id="sl_rmb" class="baifen number"> </td>
                <td id="sl_sj" class="baifen bold"></td>
                <td id="sl_dcl" class="baifen bold"></td>
                <td id="sl_dbzt" class="bold" style=" transform: scale(2, 1);"></td>
            </tr>
            <tr>
                <td  id="t_jrcqry">今日出勤人员</td>
                <td colspan="4" id="jrcqry" style="text-align: left;">
                
                </td>
            </tr>
        </tbody>
    </table>
</body>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    var getUrlParam = function (name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);// 
        if (r != null) return unescape(r[2]); return null;// 
    }
    var shengChanXian=getUrlParam("shengChanXian").split(',');
    var index = 0;

    var init = function (cx) {
        var params = { "page": 1, "rows": 1, "sort": "CreateDate", "order": "desc", "wheres": '[{"name":"shengChanXian","value":"' + shengChanXian[index] + '","displayType":"text"}]' };
        $.ajax({
            url: "http://172.21.56.96:9099/api/dataCollection_cjkb/getPageData",
            type: 'POST',
            data: JSON.stringify(params),
            contentType: 'application/json',
            dateType: 'json',
            success: function (result) {
                index ++;
                if(index==shengChanXian.length){
                    index=0;

                }
                var obj = result.rows[0];
                if (obj) {
                    $("#year").text(new Date(obj.CreateDate).getFullYear());
                    $("#month").text((parseInt(new Date(obj.CreateDate).getMonth()) + 1));
                    $("#day").text(new Date(obj.CreateDate).getDate());


                  //  $(".title").text(new Date(obj.CreateDate).getFullYear() + "年" + (parseInt(new Date(obj.CreateDate).getMonth()) + 1) + "月" + new Date(obj.CreateDate).getDate() + "日生产数据");
                    $("[id]").each(function () {
                        var id = $(this).attr('id');
                        if (id !== "") {
                            if (id == "jrcqry") {
                                $(this).html("");
                               var names=obj[id].replace(/s+/g,'').replace(/，/g,",").split(',');
                               $(names).each(function(i,val){
                                if(val!="")
                                $("#jrcqry").append('<div class="yg"><img src="img/personnel/生产/'+val+'.jpg"  onerror="this.src=\'img/default_user.jpg\';this.οnerrοr=null"  /><span class="name">'+val+'</span></div>');

                               });
                            }else{
                                var val=obj[id];

                                if(parseFloat( val)>30){
                                    val= parseFloat( val).toFixed(1);

                                }
                                $(this).text(val);
                            }
                            if (obj[id] == "合格") {
                                $(this).css("color", "red");
                                $(this).text("Y");
                            }
                            if (obj[id] == "不合格") {
                                $(this).css("color", "green");
                                $(this).text("N");
                            }
                            if (obj[id] == "上升") {
                                $(this).css("color", "red");
                                $(this).text("↑");
                            }
                            if (obj[id] == "下降") {
                                $(this).css("color", "green");
                                $(this).text("↓");
                            }
                            if (id.indexOf('dcl') !== -1) {
                                if (obj[id] >= 98) {

                                    $(this).css("color", "red");
                                } else {
                                    $(this).css("color", "green");

                                }
                            }
                        }
                    });
                    if (obj["mj_sj"] >= obj["mj_rmb"]) {
                        $(mj_sj).css("color", "red");
                    } else {

                        $(mj_sj).css("color", "green");
                    }

                    if (obj["yzl_sj"] >= obj["yzl_rmb"]) {
                        $(yzl_sj).css("color", "red");
                    } else {

                        $(yzl_sj).css("color", "green");
                    }

                    if (obj["al_sj"] >= obj["al_rmb"]) {
                        $(al_sj).css("color", "red");
                    } else {

                        $(al_sj).css("color", "green");
                    }
                    if (obj["sl_sj"] >= obj["sl_rmb"]) {
                        $(sl_sj).css("color", "red");
                    } else {

                        $(sl_sj).css("color", "green");
                    }
                }
                // $(".baifen").append("%");
                // $(".pingfang").append("(wm²)");
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                if (XMLHttpRequest.status == 401 || XMLHttpRequest.status == 402) {

                }
            }

        });
    }
    var strList = [
        { "key": "t_year", "c": "年", "h": "년" },
        { "key": "t_month", "c": "月", "h": "월" },
        { "key": "t_day", "c": "日", "h": "일" },
        { "key": "t_scqk", "c": "生产情况", "h": "생산일람표" },
        { "key": "t_cx", "c": "产线", "h": "라인" },
        { "key": "t_ddh", "c": "订单号", "h": "PO NO" },
        { "key": "t_gg", "c": "规格", "h": "규격" },
        { "key": "t_jrcqrs", "c": "今日出勤人数", "h": "금일출근인원수" },
        { "key": "t_ywgk", "c": "异物管控", "h": "이물관리" },
        { "key": "t_xm", "c": "项目", "h": "프로그램" },
        { "key": "t_rmb", "c": "日目标", "h": "일목표" },
        { "key": "t_sj", "c": "实际", "h": "실적" },
        { "key": "t_dc", "c": "达成率", "h": "달성율" },
        { "key": "t_dbzt", "c": "对比昨天", "h": "전일대비" },
        { "key": "t_mj", "c": "母卷", "h": "원단" },
        { "key": "t_yzl", "c": "运转率", "h": "가동율" },
        { "key": "t_al", "c": "A率", "h": "A급" },
        { "key": "t_sl", "c": "收率", "h": "수율" },
        { "key": "t_jrcqry", "c": "今日出勤人员", "h": "금일근무인원" }
    ]
    var tabIndex = 0;
    var tab = function () {
        $(strList).each(function () {
            if (tabIndex == 0) {
                $("#"+this.key).text(this.h);
            } else {
                $("#" + this.key).text(this.c);
            }
           

        });
        if (tabIndex == 0) {
            tabIndex = 1;
        } else {
            tabIndex = 0;
        }

    }


  
    init();
    $(document).ready(function () {
        // 每隔10秒执行一次函数
        setInterval(function () {
            // 执行的代码块
            init();
        }, 30000);

        if (getUrlParam("shengChanXian") == "CI,CJ,CK") {

        // 每隔10秒执行一次函数
        setInterval(function () {
            // 执行的代码块
            tab();
        }, 10000);
        }


    });

</script>

</html>